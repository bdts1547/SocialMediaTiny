{% load static %}
{% load filters %}

<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="favicon.png" rel="icon" type="image/png">
    <title>Home</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'assets/css/icons.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/uikit.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/tailwind.css' %}">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>

<body style="background-color: #e5e5e5 !important; ">

    {% include 'homepart/header.html' %}


    <div class="container m-auto">

        <div class="lg:flex justify-center lg:space-x-10 lg:space-y-0 space-y-5">

            <!-- left sidebar-->
            <div class="space-y-5 flex-shrink-0 lg:w-7/12">

                <div class="right-side lg:pr-4">
                    <!-- upload -->
                    <div class="upload-post">
                        <h2><strong>Upload your pictures or videos</strong></h2>
                    </div>

                    <!-- notification contents -->

                    <form id="form-upload-post">
                        {% csrf_token %}
                        <div class="flex flex-col choose-upload text-center"
                            style="border-bottom-left-radius: 5px; border-bottom-right-radius: 5px;">
                            <div class="container-form" style="background-color:rgba(255,255,255,0.8);">
                                <textarea required name="title" id="title" cols="20" rows="3"
                                    placeholder="Write caption"
                                    style="margin-top:8px; padding: 16px; background-color: #fff; width: 100px"></textarea>

                                <div id="dragger" style="background-color: #fff;">
                                    <div>
                                        <div id="showImage" style="display: flex; justify-content: center; padding: 40px; 
                                                    align-items: center; flex-direction: column; border-radius: 10px; background-color: white;
                                                     margin:auto; margin-top:8px ">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="4em" viewBox="0 0 512 512"
                                                onclick="selectImageToUpload()"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                                                <path
                                                    d="M0 96C0 60.7 28.7 32 64 32H448c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zM323.8 202.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6L170.7 297c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4s12.4 13.6 21.6 13.6h96 32H424c8.9 0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z" />
                                            </svg>

                                            <!-- <h2 style="margin-top: 8px">Drag and drop file</h2>
                                                        <h1 style="margin-top: 8px"><strong>OR</strong></h1> -->
                                        </div>
                                    </div>
                                    <input class="button soft-warning small" type="file" id="images"
                                        style="display: none;" accept="image/*re" name="images" multiple
                                        onchange="imageSelect()">
                                    <button type="button" id="" class="button soft-warning small btn-post"
                                        onclick="selectImageToUpload()">
                                        Choose file</button>
                                </div>

                                <input type="submit" value="Post" id="" class="btn-post"
                                    style="background-color: #1877f2; width:100%; height: 42px; margin-top:16px">
                            </div>
                        </div>
                    </form>


                </div>

                <div id="post-container" class="infinite-container">
                    {% for post, profile, list_images, comments, is_liked in data %}
                    
                    <!-- post -->
                    <div id="{{post.id}}" class="infinite-item bg-white shadow rounded-md -mx-2 lg:mx-0" style="margin-top: 16px;">

                        <!-- post header-->
                        <div class="flex justify-between items-center px-4 py-3">
                            <div class="flex flex-1 items-center space-x-4">
                                <a href="{{profile.image_path}}">
                                    <div class="bg-gradient-to-tr from-yellow-600 to-pink-600 p-0.5 rounded-full">
                                        <img src="{{profile.image_path}}"
                                            class="bg-gray-200 border border-white rounded-full w-8 h-8">
                                    </div>
                                </a>
                                <a href="/profile/{{post.user.username}}" class="block capitalize" style="font-weight: 800; color:black">
                                    {{post.user.username}} </a>

                            </div>
                            <h4 class="block capitalize font-semibold ">{{post.created_at}}</h4>

                            <!-- Post control -->
                            <div class="post-control">
                                <div> <i
                                        class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 "></i>
                                </div>
                                <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100  "
                                    uk-drop="mode: hover;pos: top-right">

                                    <ul class="space-y-1">
                                        <li>
                                            <a onclick="hidePost(event)" href="" class="hide-post flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                                <i class="uil-share-alt mr-1"></i> Hide Post
                                                <input type="hidden" name="id_post" value="{{ post.id }}">
                                            </a>
                                        </li>

                                        {% if post.user == user %}
                                            <li>
                                                <a onclick="showModalEditor(event)" href=""
                                                    class="js-edit-post flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                                    <i class="uil-edit-alt mr-1">
                                                        <input type="hidden" name="id_post" value="{{post.id}}">
                                                    </i> Edit Post
                                                </a>
                                            </li>

                                            {% if post.is_enabled_comments %}
                                            <li>
                                                <a href="" style="color:#ef0c0c;" class="dis-enable-comment flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                                    <i class="uil-comment-slash mr-1">
                                                        <input type="hidden" name="id_post" value="{{post.id}}">
                                                    </i> 
                                                    <span >Disable comments</span>
                                                </a>
                                            </li>
                                            {% else %}
                                            <li>
                                                <a href="" style="color:#0de510;" class="dis-enable-comment flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                                    <i class="uil-comment-slash mr-1">
                                                        <input type="hidden" name="id_post" value="{{post.id}}">
                                                    </i> 
                                                    <span >Enable comments</span>
                                                </a>
                                            </li>
                                            {% endif %}
                                        {% endif %}

                                        <li>
                                            <hr class="-mx-2 my-2 ">
                                        </li>

                                        {% if user.is_staff and post.user != user %}
                                        {% if post.user|has_perm:'core.add_post' %}
                                        <li>
                                            <a href="" style="color: #ffc107;"
                                                class="ban_user flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-500 rounded-md ">
                                                <i class="uil-ban mr-1">
                                                    <input type="hidden" name="id_user_ban" value="{{post.user.id}}">
                                                </i> Ban User
                                            </a>
                                        </li>
                                        {% else %}
                                        <li>
                                            <a href="" style="color: #0de510;"
                                                class="ban_user flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-500 rounded-md ">
                                                <i class="uil-ban mr-1">
                                                    <input type="hidden" name="id_user_unban" value="{{post.user.id}}">
                                                </i> Unban User
                                            </a>
                                        </li>
                                        {% endif %}
                                        {% endif %}

                                        {% if user == post.user or perms.core.delete_post %}
                                        <li>
                                            <a href=""
                                                class="delete_post flex items-center px-3 py-2 text-red-500 hover:bg-red-100 hover:text-red-500 rounded-md ">
                                                <i class="uil-trash-alt mr-1">
                                                    <input type="hidden" name="delete_post" value="{{post.id}}">
                                                </i> Delete
                                            </a>
                                        </li>
                                        {% endif %}


                                    </ul>

                                </div>
                            </div>
                        </div>

                        <h2 class="post-title">
                            {{post.title}}
                        </h2>

                    
                        <div class="post-image" uk-lightbox>
                            <div class="grid grid-cols-2 gap-2 p-2">
                                {% for image in list_images %}
                                {% if forloop.counter0 == 0 %}
                                <a href="{{image.image_path}}" class="col-span-2">
                                    <img src="{{image.image_path}}" alt=""
                                        class="rounded-md w-full lg:h-76 object-cover">
                                </a>
                                {% elif forloop.counter0 == 1 %}
                                <a href="{{image.image_path}}">
                                    <img src="{{image.image_path}}" alt="" class="rounded-md w-full h-full">
                                </a>
                                {% elif forloop.counter0 == 2 %}
                                <a href="{{image.image_path}}" class="relative">
                                    <img src="{{image.image_path}}" alt="" class="rounded-md w-full h-full">
                                    {% if list_images|length > 3 %}
                                    <div
                                        class="absolute bg-gray-900 bg-opacity-30 flex justify-center items-center text-white rounded-md inset-0 text-2xl">
                                        +{{list_images|length|subtract:3}} more
                                    </div>
                                    {% endif %}
                                </a>
                                {% elif forloop.counter0 >= 3 %}
                                <a href="{{image.image_path}}">
                                    <img src="{{image.image_path}}" alt="" style="width: 0;">
                                </a>

                                {% endif %}

                                {% endfor %}
                            </div>
                        </div>
                      

                        <!-- Box like-commment -->
                        <div class="py-3 px-4 space-y-3">

                            <div class="flex space-x-4 lg:font-bold">
                                <!-- Like icon -->
                                <div style="display: flex; align-items:center;width:40%">
                                    <a href="" class="like_post flex items-center space-x-2">
                                        <input type="hidden" name="id_post" value="{{post.id}}">
                                        <div class="p-2 rounded-full text-black">
                                            {% if is_liked == True %}
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" width="25" height="25" style="color: blue;">
                                                <path
                                                    d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
                                            </svg>
                                            {% else %}
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" width="25" height="25">
                                                <path
                                                    d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
                                            </svg>
                                            {% endif %}
                                        </div>
                                    </a>
                                    <a class="show-likes" style="margin-left: 8px; margin-top:4px;">
                                        <input type="hidden" name="id_post" value="{{post.id}}">
                                        <span class="numberOfLikes">{{post.no_of_likes}}</span> <strong>Liked</strong>
                                    </a>
                                </div>

                                <!-- Comment icon -->
                                <div class="" style="display: flex; align-items:center">
                                    <a class="comment_post" href="#" class="flex items-center space-x-2">
                                        <div class="p-2 rounded-full text-black">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" width="25" height="25" class=""
                                                style="margin-top:2px">
                                                <path fill-rule="evenodd"
                                                    d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                    </a>
                                    <a href="#" style="margin-left: 8px; margin-top:4px;">
                                        <span class="numberOfComments">{{post.no_of_comments}}</span>
                                        <strong>Comment</strong>
                                    </a>
                                </div>

                            </div>
                            <hr>
                            <!-- <div class="flex items-center space-x-3">
                                <div class="flex items-center">
                                    <img src="{% static 'assets/images/avatars/avatar-1.jpg' %}" alt=""
                                        class="w-6 h-6 rounded-full border-2 border-white ">
                                    <img src="{% static 'assets/images/avatars/avatar-4.jpg' %}" alt=""
                                        class="w-6 h-6 rounded-full border-2 border-white  -ml-2">
                                    <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" alt=""
                                        class="w-6 h-6 rounded-full border-2 border-white  -ml-2">
                                </div>
                                <div class="">
                                    
                                    Liked <strong> taiye</strong> and <strong> 209 Others </strong>
                                </div>
                            </div> -->

                            <!-- Comments -->
                            {% if post.is_enabled_comments %}
                            <div class="comment_container" class="border-t pt-4 space-y-4">
                                <div class="comments">
                                    {% for comment in comments reversed %}
                                    <div class="comment flex">
                                        <a href="{{comment.user.profile.image_path}}" class="w-10 h-10 rounded-full relative flex-shrink-0">
                                            <img src="{{comment.user.profile.image_path}}" alt=""
                                                class="absolute h-full rounded-full w-full">
                                        </a>
                                        <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 h-full relative lg:ml-5 ml-2 lg:mr-20   ">
                                            <a href="/profile/{{comment.user.username}}"><b>{{comment.user.username}}</b></a>
                                            <p class="leading-6">{{comment.comment}} </p>
                                            <div
                                                class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 ">
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>

                                <hr>
                                <!-- Input comment -->
                                <form class="form-comment-post" action="">
                                    {% csrf_token %}
                                    <div class="bg-gray-100 bg-gray-100 rounded-full rounded-md relative ">
                                        <input type="hidden" name="id_post" value="{{post.id}}">
                                        <input required name="comment" type="text" placeholder="Enter comment"
                                            class="bg-transparent max-h-10 shadow-none">
                                        <div
                                            class="absolute bottom-0 flex h-full items-center right-0 right-3 text-xl space-x-2">
                                            <a href="#"> <i class="uil-image"></i></a>
                                            <a href="#"> <i class="uil-video"></i></a>
                                        </div>
                                    </div>
                                    <button type="submit" value=""></button>
                                </form>
                            </div>
                            {% else %}
                            <div class="comment_container" class="border-t pt-4 space-y-4" style="display: none;">
                                <div class="comments">
                                    {% for comment in comments reversed %}
                                    <div class="comment flex">
                                        <a href="{{comment.user.profile.image_path}}" class="w-10 h-10 rounded-full relative flex-shrink-0">
                                            <img src="{{comment.user.profile.image_path}}" alt=""
                                                class="absolute h-full rounded-full w-full">
                                        </a>
                                        <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 h-full relative lg:ml-5 ml-2 lg:mr-20   ">
                                            <a href="/profile/{{comment.user.username}}"><b>{{comment.user.username}}</b></a>
                                            <p class="leading-6">{{comment.comment}} </p>
                                            <div
                                                class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 ">
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>

                                <hr>
                                <!-- Input comment -->
                                <form class="form-comment-post" action="">
                                    {% csrf_token %}
                                    <div class="bg-gray-100 bg-gray-100 rounded-full rounded-md relative ">
                                        <input type="hidden" name="id_post" value="{{post.id}}">
                                        <input required name="comment" type="text" placeholder="Enter comment"
                                            class="bg-transparent max-h-10 shadow-none">
                                        <div
                                            class="absolute bottom-0 flex h-full items-center right-0 right-3 text-xl space-x-2">
                                            <a href="#"> <i class="uil-image"></i></a>
                                            <a href="#"> <i class="uil-video"></i></a>
                                        </div>
                                    </div>
                                    <button type="submit" value=""></button>
                                </form>
                            </div>
                            {% endif %}
                        
                        </div>

                    </div>

                    {% endfor %}
                    <div class="">
                        {% if data.has_next %}
                            <a class="infinite-more-link" href="?page={{ data.next_page_number }}" style="display: none;">
                                Loading
                            </a>
                            <!-- <span>{{data.next_page_number}}</span> -->
                        {% endif %}
                    </div>
                </div>











                <!-- post 4-->
                <!-- <div class="bg-white shadow rounded-md  -mx-2 lg:mx-0" id="toggle">

                            <div class="flex justify-between items-center px-4 py-3">
                                <div class="flex flex-1 items-center space-x-4">
                                    <a href="#">
                                        <div class="bg-gradient-to-tr from-yellow-600 to-pink-600 p-0.5 rounded-full">
                                            <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}"
                                                class="bg-gray-200 border border-white rounded-full w-8 h-8">
                                        </div>
                                    </a>
                                    <span class="block capitalize font-semibold "> tomi_ml </span>
                                </div>
                                <div>
                                    <a href="#"> <i
                                            class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 "></i>
                                    </a>
                                    <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100  "
                                        uk-drop="mode: hover;pos: top-right">

                                        <ul class="space-y-1">
                                            <li>
                                                <a href="#"
                                                    class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                                    <i class="uil-share-alt mr-1"></i> Share
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#"
                                                    class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                                    <i class="uil-edit-alt mr-1"></i> Edit Post
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#"
                                                    class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                                    <i class="uil-comment-slash mr-1"></i> Disable comments
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#"
                                                    class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md ">
                                                    <i class="uil-favorite mr-1"></i> Add favorites
                                                </a>
                                            </li>
                                            <li>
                                                <hr class="-mx-2 my-2 ">
                                            </li>
                                            <li>
                                                <a href="#"
                                                    class="flex items-center px-3 py-2 text-red-500 hover:bg-red-100 hover:text-red-500 rounded-md ">
                                                    <i class="uil-trash-alt mr-1"></i> Delete
                                                </a>
                                            </li>
                                        </ul>

                                    </div>
                                </div>
                            </div>


                            <div class="w-full h-full">
                                <iframe src="https://www.youtube.com/embed/pQN-pnXPaVg" frameborder="0"
                                    uk-video="automute: true" allowfullscreen uk-responsive
                                    class="w-full lg:h-64 h-40"></iframe>
                            </div>


                            <div class="py-3 px-4 space-y-3">

                                <div class="flex space-x-4 lg:font-bold">
                                    <a href="#" class="flex items-center space-x-2">
                                        <div class="p-2 rounded-full text-black">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                                width="25" height="25" class="">
                                                <path
                                                    d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
                                            </svg>
                                        </div>

                                    </a>
                                    <a href="#" class="flex items-center space-x-2">
                                        <div class="p-2 rounded-full text-black">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                                width="25" height="25" class="">
                                                <path fill-rule="evenodd"
                                                    d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </div>

                                    </a>
                                    <a href="#" class="flex items-center space-x-2 flex-1 justify-end">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                            width="25" height="25" class="">
                                            <path
                                                d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                                        </svg>

                                    </a>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="flex items-center">
                                        <img src="{% static 'assets/images/avatars/avatar-1.jpg' %}" alt=""
                                            class="w-6 h-6 rounded-full border-2 border-white ">
                                        <img src="{% static 'assets/images/avatars/avatar-4.jpg' %}" alt=""
                                            class="w-6 h-6 rounded-full border-2 border-white  -ml-2">
                                        <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" alt=""
                                            class="w-6 h-6 rounded-full border-2 border-white  -ml-2">
                                    </div>
                                    <div class="">
                                        Liked <strong> taiye</strong> and <strong> 209 Others </strong>
                                    </div>
                                </div>

                                <div class="border-t pt-4 space-y-4 ">
                                    <div class="flex">
                                        <div class="w-10 h-10 rounded-full relative flex-shrink-0">
                                            <img src="{% static 'assets/images/avatars/avatar-1.jpg' %}" alt=""
                                                class="absolute h-full rounded-full w-full">
                                        </div>
                                        <div
                                            class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 h-full relative lg:ml-5 ml-2 lg:mr-20   ">
                                            <p class="leading-6">Y'all like billie eillish? <urna class="i uil-heart"></urna> <i
                                                    class="uil-grin-tongue-wink"> </i> </p>
                                            <div class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 "></div>
                                        </div>
                                    </div>
                                    <div class="flex">
                                        <div class="w-10 h-10 rounded-full relative flex-shrink-0">
                                            <img src="{% static 'assets/images/avatars/avatar-1.jpg' %}" alt=""
                                                class="absolute h-full rounded-full w-full">
                                        </div>
                                        <div
                                            class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 h-full relative lg:ml-5 ml-2 lg:mr-20   ">
                                            <p class="leading-6">She's my favourite <i class="uil-grin-tongue-wink-alt"></i>
                                            </p>
                                            <div class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 "></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-gray-100 bg-gray-100 rounded-full rounded-md relative ">
                                    <input type="text" placeholder="post a comment" class="bg-transparent max-h-10 shadow-none">
                                    <div class="absolute bottom-0 flex h-full items-center right-0 right-3 text-xl space-x-2">
                                        <a href="#"> <i class="uil-image"></i></a>
                                        <a href="#"> <i class="uil-video"></i></a>
                                    </div>
                                </div>

                            </div>

                        </div> -->


            </div>

            <!-- right sidebar-->
            <div class="lg:w-5/12">

                <div class="bg-white  shadow-md rounded-md overflow-hidden">

                    <div class="bg-gray-50  border-b border-gray-100 flex items-baseline justify-between py-4 px-6 ">
                        <h2 class="font-semibold text-lg">Users You Can Follow</h2>
                        <a id="js-refresh-user" href=""> Refresh </a>
                    </div>

                    <div id="js-user-suggestion" class="divide-gray-300 divide-gray-50 divide-opacity-50 divide-y px-4 ">
                        {% for user_sugg in user_suggestion %}
                        <div class="flex items-center justify-between py-3">

                            <div class="flex flex-1 items-center space-x-4">
                                <a href="{{ user_sugg.profile.image_path }}">
                                    <img src="{{ user_sugg.profile.image_path }}"
                                        class="bg-gray-200 rounded-full w-10 h-10">
                                </a>
                                <a class="flex flex-col" href="/profile/{{ user_sugg.username}}">
                                    <span class="block capitalize font-semibold"> {{ user_sugg.username}} </span>
                                    <span class="num-follower block capitalize text-sm"> {{ user_sugg|count_followers }} followers </span>
                                </a>
                            </div>

                            <button class="js-follow">
                                <span class="border border-gray-200 font-semibold px-4 py-1 rounded-full hover:bg-pink-600 hover:text-white hover:border-pink-600 ">Follow</span>
                                {% csrf_token %}
                                <input type="hidden" name="id_user_followed" value="{{ user_sugg.id }}">
                                <input type="hidden" name="id_user_following" value="{{ user.id }}">
                            </button>
                        </div>
                        {% endfor %}

                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>
    </div>


    {% include 'homepart/modal.html' %}





    <!-- Scripts
    ================================================== -->
    <script src="{% static 'assets/js/tippy.all.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'assets/js/uikit.js' %}"></script>
    <script src="{% static 'assets/js/simplebar.js' %}"></script>
    <script src="{% static 'assets/js/custom.js' %}"></script>]

    <script src="{% static 'assets/js/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'assets/js/infinite.min.js '%}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.5/waypoints.min.js"></script>

    <script src="{% static '../../unpkg.com/ionicons%405.2.3/dist/ionicons.js' %}"></script>

    <script>
        

        var infinite = new Waypoint.Infinite({
            element: $('.infinite-container')[0],
            offset: 'bottom-in-view',
            onBeforePageLoad: function() {

            },
            onAfterPageLoad: function() {

            }


        })
    </script>

    <script type="text/javascript">
        var listImage = [];

        function selectImageToUpload() {
            var btn = document.getElementById('images')
            btn.click()
        }

        function imageSelect() {

            var inputImage = document.getElementById('images').files;
            for (var i = 0; i < inputImage.length; i++) {
                listImage.push({
                    "name": inputImage[i].name,
                    "url": URL.createObjectURL(inputImage[i]),
                    "file": inputImage[i],
                });
            }

            const showImageChoose = document.getElementById('showImage');
            showImageChoose.style.flexDirection = 'row';
            showImageChoose.style.flexWrap = 'wrap';
            showImageChoose.innerHTML = imageShow();

        }

        function imageShow() {
            var imageHTML = "";
            var count = 0;

            for (var i = 0; i < listImage.length; i++) {
                if (count == 5) {
                    imageHTML += `<h1 class="image-upload" style="font-size: 32px; width: 33%;">+${listImage.length - 5} images</h1>`;
                    break;
                }
                imageHTML += `<img class="image-upload" style="float: left; width: 33%; padding: 5px" src="${listImage[i].url}" alt="" width="100" height="100" class="mt-2 mb-2">`
                count++;
            }


            return imageHTML;
        }

        function hidePost(event) {
            event.preventDefault();

            var root = event.target;
            while (root.tagName !== "LI") {
                root = root.parentNode;
            }
            
            const id = root.querySelector('input[name=id_post]').value;
            document.getElementById(id).style.display = 'none';
        }

        // AJAX 
        // Upload post
        $(document).on('submit', '#form-upload-post', function (e) {
            e.preventDefault();

            const ipImages = $('#images')[0].files;
            var formData = new FormData();

            for (let i = 0; i < ipImages.length; i++) {
                formData.append('images[]', ipImages[i])
            }


            formData.append('title', $('#title').val())
            formData.append('csrfmiddlewaretoken', $('input[name=csrfmiddlewaretoken]').val())

            $.ajax({
                type: 'post',
                url: '/upload_post/',
                processData: false,
                contentType: false,
                enctype: 'multipart/form-data',
                data: formData,
                success: function (res) {
                    
                    window.location.assign("/")
                },
                error: function (xhr) {
                    if (xhr.status === 403) {
                        alert("You aren't permission to upload");
                    }
                    else {
                        console.log(xhr.responseText);
                    }
                }

            })

        })

        // Edit post
        $(document).on('submit', '#js-form-edit-post', function (e) {
            e.preventDefault();

            const inputImage = document.getElementById('js-edit-images').files;
            const formData = new FormData();


            // Note: need process the same name
            for (var obj of listImagesURL) {
                let is_ip = true;
                for (let i = 0; i < inputImage.length; i++) {
                    if (obj['name'] === inputImage[i].name) {
                        formData.append('new_images', inputImage[i])
                        is_ip = false;
                        break;
                    }
                }

                if (is_ip) {
                    formData.append('old_images', obj['url']);
                }
            }


            formData.append('id', e.target.querySelector('input[name=id_post]').value);
            formData.append('title', $('#title_change').val());
            formData.append('csrfmiddlewaretoken', $('input[name=csrfmiddlewaretoken]').val());

            $.ajax({
                type: 'POST',
                url: '/edit_post/',
                processData: false,
                contentType: false,
                enctype: 'multipart/form-data',
                data: formData,
                success: function (res) {
                    alert('Edit successful');

                    // Rerender after edit
                    const post = document.getElementById(res['id']);
                    if (post) {
                        const titleContainer = post.querySelector('.post-title');
                        const imageContainer = post.querySelector('.post-image');

                        titleContainer.textContent = res['title'];
               
                        var textHTML = "";
                        for (let i = 0; i < res['path_images'].length; i++) {
                            if (i === 0) {
                                textHTML += `
                                <a href="${res['path_images'][i]}" class="col-span-2">
                                    <img src="${res['path_images'][i]}" alt="" class="rounded-md w-full lg:h-76 object-cover">
                                </a>
                                `;
                            }
                            else if (i === 1) {
                                textHTML += `
                                <a href="${res['path_images'][i]}">
                                    <img src="${res['path_images'][i]}" alt="" class="rounded-md w-full h-full">
                                </a>
                                `;
                            }
                            else if (i === 2) {
                                if (res['path_images'].length > 3) {
                                    textHTML += `
                                    <a href="${res['path_images'][i]}" class="relative">
                                        <img src="${res['path_images'][i]}" alt="" class="rounded-md w-full h-full">
                                        <div class="absolute bg-gray-900 bg-opacity-30 flex justify-center items-center text-white rounded-md inset-0 text-2xl">
                                            +${res['path_images'].length - 3} more 
                                        </div>
                                    </a>
                                    `;
                                }
                                else {
                                    textHTML += `
                                    <a href="${res['path_images'][i]}" class="relative">
                                        <img src="${res['path_images'][i]}" alt="" class="rounded-md w-full h-full">
                                    </a>
                                    `;
                                }
                            }
                            else {
                                textHTML += `
                                <a href="${res['path_images'][i]}">
                                    <img src="${res['path_images'][i]}" alt="" style="width: 0;">
                                </a>
                                `;
                            }
                        };


                        imageContainer.querySelector('div').innerHTML = textHTML;
                    }

                },
                error: function (xhr) {
                    if (xhr.status === 403) {
                        alert("You aren't permission to edit");
                    }
                    else {
                        alert("ERR")
                    }
                }
            });

        })

        


        // Like
        $(document).on('click', '.like_post', function (event) {
            event.preventDefault()
            var rootElement = event.target;

            while (rootElement.tagName !== 'A') {
                rootElement = rootElement.parentNode;
            }
            const svgElement = rootElement.querySelector('svg')
            const id = rootElement.querySelector('input[name=id_post]').value;


            $.ajax({
                type: 'get',
                url: `/like_post/?id_post=${id}`,
                data: {
                    'id_post': id,
                },
                success: function (res) {
                    const likeContainer = rootElement.parentNode;
                    const numOfLikeElement = likeContainer.querySelector('.numberOfLikes')
                    var numOfLikes = parseInt(numOfLikeElement.textContent)


                    if (res['is_liked']) {
                        svgElement.style.color = 'blue'
                        numOfLikeElement.textContent = numOfLikes + 1
                    } else {
                        svgElement.style.color = ''
                        numOfLikeElement.textContent = numOfLikes - 1
                    }

                },
                error: function (xhr) {
                    if (xhr.status === 403) {
                        alert("You aren't permission to like");
                    }
                    else {
                        alert("ERR")
                    }
                }
            })
        })

        // comment
        $(document).on('submit', '.form-comment-post', function (e) {
            e.preventDefault();
            const form = e.target;
            const id_post = form.querySelector('input[name=id_post]').value;

            var formData = new FormData();
            formData.append('comment', form.querySelector('input[name=comment]').value);
            formData.append('id_post', id_post);
            formData.append('csrfmiddlewaretoken', form.querySelector('input[name=csrfmiddlewaretoken]').value);

            $.ajax({
                type: 'post',
                url: '/comment_post/',
                processData: false,
                contentType: false,
                data: formData,
                success: function (res) {
                    const commentContainer = form.parentNode;
                    const comments = commentContainer.querySelector('.comments');
                    const rootPost = document.getElementById(id_post);
                    const numberOfComments = rootPost.querySelector('.numberOfComments');

                    var newComment = `
                    <div class="flex" style="margin-bottom: 8px;">
                        <a href="${res['image_path']}" class="w-10 h-10 rounded-full relative flex-shrink-0">
                            <img src="${res['image_path']}" alt=""
                                class="absolute h-full rounded-full w-full">
                        </a>
                        <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 h-full relative lg:ml-5 ml-2 lg:mr-20   ">
                            <a href="/profile/${res['username']}"><b>${res['username']}</b></a>
                            <p class="leading-6">${res['comment']} </p>
                            <div class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 "></div>
                        </div>
                    </div>
                    `

                    numberOfComments.textContent = res['no_of_comments'];
                    comments.innerHTML = newComment + comments.innerHTML;
                    form.reset();
                },
                error: function (xhr) {
                    if (xhr.status === 403) {
                        alert("You aren't have permission");
                    }
                    else {
                        alert('ER')
                    }
                }
            });
        })

        // Dis-Enable comments
        $(document).on('click', '.dis-enable-comment', function(e) {
            e.preventDefault();
            const id_post = e.target.parentNode.querySelector('input[name=id_post]').value;
            const rootPost = document.getElementById(id_post);

            $.ajax({
                type: 'POST',
                url: '/dis_enable_comment/',
                data: {
                    id_post: id_post,
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function(res) {
                    
                    var aTag = e.target;
                    while (aTag.tagName !== "A") {
                        aTag = aTag.parentNode;
                    }
                 
                    if (res['is_enabled_comments']) {
                        alert('Enabled comment');
                        aTag.querySelector('span').textContent = "Disable comment";
                        aTag.style.color = "#ef0c0c";
                        rootPost.querySelector('.comment_container').style.display = 'block';
                    }
                    else {
                        alert('Disabled comment');
                        aTag.querySelector('span').textContent = "Enable comment";
                        aTag.style.color = '#0de510';
                        rootPost.querySelector('.comment_container').style.display = 'none';
                    }
                },
                error: function() {
                    alert('ERROR');
                }

            });
        })

        // Show likes post
        $(document).on('click', '.show-likes', function (e) {
            e.preventDefault();

            var root = e.target;
            while (root.className !== 'show-likes') {
                root = root.parentNode;
            }

            const id = root.querySelector('input[name=id_post]').value;

            $.ajax({
                type: 'get',
                url: `/show_likes/${id}`,
                data: {

                },
                success: function (res) {
                    var modalHTML = "";
                    for (const user of res['data']) {
                        if (user['is_followed']) {
                            modalHTML += `
                            <div class="user">
                                <a href="/profile/${user.username}" class="user-profile">
                                    <img src="${user['image_path']}" alt="" class="rounded-md w-full lg:h-76 object-cover">
                                    <p>${user['username']}</p> 
                                </a>
                            </div>
                            `;
                        }
                        else {
                            modalHTML += `
                            <div class="user">
                                <a href="/profile/${user.username}" class="user-profile">
                                    <img src="${user['image_path']}" alt="" class="rounded-md w-full lg:h-76 object-cover">
                                    <p>${user['username']}</p> 
                                </a>
                                <button class="js-follow button border border-gray-200 font-semibold px-4 py-1 rounded-full hover:bg-pink-600 hover:text-white hover:border-pink-600">
                                    Follow 
                                    {% csrf_token %}
                                    <input type="hidden" name="id_user_followed" value="${user.id}">
                                    <input type="hidden" name="id_user_following" value="${res['user_login'].id}">
                                </button>
                            </div>
                            `;

                        }
                    };
                    document.getElementById('js-show-user-like').innerHTML = modalHTML
                    const modalLike = document.getElementById('modal-like');
                    modalLike.style.display = 'flex';
                },
                error: function () {
                    alert("ERR")
                }
            });
        })

        // Delete post
        $(document).on('click', '.delete_post', function (e) {
            e.preventDefault();
            const id_post = e.target.querySelector('input[name="delete_post"]').value;

            $.ajax({
                type: 'post',
                url: '/delete_post/',
                data: {
                    'id_post': id_post,
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function (res) {
                    alert('Delete successful')
                    if (res['is_deleted']) {
                        document.getElementById(`${id_post}`).style.display = 'none';
                    }
                },
                error: function (res) {
                    alert("You don't have permission to detele");
                }
            });

        })

        // Banning User
        $(document).on('click', '.ban_user', function (e) {
            e.preventDefault();

            var root = e.target;
            while (root.tagName !== 'LI') {
                root = root.parentNode;
            }

            var id_user_ban, id_user_unban;
            if (e.target.querySelector('input[name=id_user_ban]')) {
                id_user_ban = e.target.querySelector('input[name=id_user_ban]').value;
                id_user_unban = "-1";
            }
            else {
                id_user_unban = e.target.querySelector('input[name=id_user_unban]').value;
                id_user_ban = "-1";
            }


            $.ajax({
                type: 'post',
                url: '/ban_user/',
                data: {
                    'id_user_ban': id_user_ban,
                    'id_user_unban': id_user_unban,
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function (res) {
                    if (res['type'] === 'ban') {
                        alert('User is banned');
                        textHTML = `
                            <a href="" style="color: #0de510;" class="ban_user flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-500 rounded-md ">
                                <i  class="uil-ban mr-1">
                                    <input type="hidden" name="id_user_unban" value="${id_user_ban}">
                                </i> Unban User
                            </a>
                        `
                        root.innerHTML = textHTML
                    }
                    else if (res['type'] === 'unban') {
                        alert('User is unbanned');
                        textHTML = `
                            <a href="" style="color: #ffc107;" class="ban_user flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-500 rounded-md ">
                                <i  class="uil-ban mr-1">
                                    <input type="hidden" name="id_user_ban" value="${id_user_unban}">
                                </i> Ban User
                            </a>
                        `
                        root.innerHTML = textHTML

                    }
                },
                error: function (res) {
                    alert('You aren\'t allowed or user isn\'t exist');
                }
            });
        });

        // Follow refresh
        $(document).on('click', '#js-refresh-user', function(e) {
            e.preventDefault();

            $.ajax({
                type: 'get',
                url: '/follow/',
                success: function(res) {
                    var textHTML = "";
                    for (const user of res['user_suggestion']) {
                        textHTML += `
                        <div class="flex items-center justify-between py-3">

                            <div class="flex flex-1 items-center space-x-4">
                                <a href="${user.image_path}">
                                    <img src="${user.image_path}"
                                        class="bg-gray-200 rounded-full w-10 h-10">
                                </a>
                                <a class="flex flex-col" href="/profile/${user.username}">
                                    <span class="block capitalize font-semibold"> ${user.username} </span>
                                    <span class="num-follower block capitalize text-sm"> ${user.followers.length} followers </span>
                                </a>
                            </div>

                            <button href="" class="js-follow">
                                <span class="border border-gray-200 font-semibold px-4 py-1 rounded-full hover:bg-pink-600 hover:text-white hover:border-pink-600 ">Follow</span>
                                {% csrf_token %}
                                <input type="hidden" name="id_user_followed" value="${user.id}">
                                <input type="hidden" name="id_user_following" value="${res['user_login'].id}">
                            </button>
                        </div>
                        `;

                        
                    }
                    document.getElementById('js-user-suggestion').innerHTML = textHTML;

                },
                error: function(err) {
                    alert("ERR")
                } 
            });

        })

        // Following
        $(document).on('click', '.js-follow', function(e) {
            e.preventDefault();

            var root = e.target;
            while (root.tagName !== 'BUTTON') {
                root = root.parentNode;
            }


            $.ajax({
                type: 'post',
                url: '/follow/',
                data: {
                    id_user_followed: root.querySelector('input[name=id_user_followed]').value,
                    id_user_following: root.querySelector('input[name=id_user_following]').value,
                    csrfmiddlewaretoken: root.querySelector('input[name=csrfmiddlewaretoken]').value,
                },
                success: function(res) {
                    root.style.display = 'none';
                    if (root.parentNode.querySelector('.num-follower')) {
                        root.parentNode.querySelector('.num-follower').innerText = res['no_of_followers'] + " followers"
                    }


                },
                error: function(xhr) {
                    if (xhr.status === 403) {
                        alert('You don\'t have permission');
                    }
                    else {
                        alert("ERR");
                    }
                }
            })
        })

    
       

    </script>
</body>


</html>